{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/211214-kbro-saas-jos-loss-discussion-chris/","result":{"data":{"markdownRemark":{"html":"<p>description: test</p>\n<p>客戶主動查詢的做法</p>\n<ul>\n<li>定時trigger 主動查詢而非 job loss timeout triggered (要實作 job timer 成本高)</li>\n<li>queryDuractionJobCompletion?start<em>time=xx&#x26;end</em>time=xx&#x26;report<em>fail</em>only=true  </li>\n</ul>\n<p>需要 Global job loss detection alarm 機制</p>\n<p>inference / sidekiq / lambda</p>\n<p>imphog / 所有錯誤在SQS 處理 (DLQ 本質是墳場) / 提高 RD 對 DLQ 敏感性</p>\n<p>SQS / Fifo or standard / message 重複回報透過SQS message delete 顯示 invalid 來丟棄</p>\n<h3>殘稿</h3>\n<p>特別是系統成熟了，又有越多的內站常態運行可能出錯，或是要求回報的數量不允許任何誤差，我們就需要這個機制來確保至少能回報錯誤。</p>\n<p>在我們討論解決方案的時候會考慮效率問題，畢竟我們有商業考量且開發資源有限，有些萬金油的解決方案不見得是現在最需要做的，如果能接地氣討論實際已經發生的問題應該更值得我們關注去解決，其次再去設想討論具體可能發生但還沒發生的狀況。</p>\n<p>那我們用事件性的解決方式好像比較好：</p>\n<p>部署前的單元測試</p>\n<p>RD進場找到問題然後加入測項</p>\n<p>偵測任務的累積並異常回報Owner。</p>\n<p>不知為何某站沒有回應能力應該會探究為何？因為我們雲端也商轉好幾年了，在有健康偵測的情況某個後端完全失效的狀況幾乎不可能漫延開，加上</p>\n<p>那我們用事件性的解決方式好像比較好：</p>\n<p>部署前的單元測試</p>\n<p>RD進場找到問題然後加入測項</p>\n<p>偵測任務的累積並異常回報Owner。</p>\n<p>如果我們要選擇一個有效率的</p>\n<p>Jacky 把 job retry 從 10 → 2 只是 work around 反而造成其他問題</p>\n<p>DLQ error 先分類再解決問題</p>\n<p>定義 errorcause 欄位</p>\n<p>SaaS 20211222-150352(1)</p>\n<p>Hi Shaq, </p>\n<p>答案很顯然是 2)。 </p>\n<p>實務做法上內部的每一棒確保自己必須要把結果無論對錯往下一棒遞交，這樣的責任分配的系統設計可以比較單純。反映到這件事情上來說合理的解決方案優先順序是：</p>\n<ol>\n<li>job 派發對象 IMP 如果發現錯誤，應該遞交錯誤結果而非使 job中斷</li>\n<li>job 進入DLQ 設計為非正常流程，屬 IMP own RD 該介入的層次應設計通知 RD 處理機制</li>\n<li>將內部各站當作黑盒子，有一個站在更高的系統層次隨時追蹤job 狀況並timeout 回報 client。在我的設計策略中這種做法會是最後的手段，開發成熟遞交後這種狀況應該要極少發生到即便沒有設計對應機制都屬可接受，不屬於常規手段，如此才有機會以合理成本運行。</li>\n</ol>\n<p>11月初跟12月中我分別跟 Eason 與 Chris 提到過目前存在 job 中斷在 IMP 的風險，1)是 Eason 紀錄的 Followup 項，應是卡住了還未實作</p>\n<hr>\n<hr>","frontmatter":{"title":"211214 KBro SaaS Jos loss discussion - Chris","description":"test","image":{"childImageSharp":{"resize":{"src":"/static/d10d93d37152e1da01ffb2cd57004432/72b5a/c49c5b85052b889226858e6b8ff75ea6bce8edaf.png","height":630,"width":1200}}}}}},"pageContext":{"slug":"/211214-kbro-saas-jos-loss-discussion-chris/","previousPost":null,"nextPost":null}},"staticQueryHashes":["3868140423","4085307986"]}